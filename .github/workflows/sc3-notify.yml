name: è·å–Aè‚¡æ¶¨è·Œå®¶æ•°å¹¶æ¨é€é€šçŸ¥

on:
  schedule:
    - cron: "*/15 * * * *"  # æ¯15åˆ†é’Ÿæ‰§è¡Œä¸€æ¬¡
  workflow_dispatch:        # æ”¯æŒæ‰‹åŠ¨è§¦å‘

jobs:
  check_a_shares:
    runs-on: ubuntu-latest

    steps:
      - name: è·å–æ¶¨è·Œå®¶æ•°(æ–°æµªè´¢ç»æ¥å£)
        run: |
          echo "æ­£åœ¨è·å–Aè‚¡å¸‚åœºæ•°æ®ï¼ˆæ–°æµªè´¢ç»æ¥å£ï¼‰..."

          # ä½¿ç”¨æ–°æµªæ¥å£ï¼ŒGitHubå›½å¤–æœåŠ¡å™¨èƒ½è®¿é—®
          data=$(curl -s "https://hq.sinajs.cn/list=sh000001,sz399001" | iconv -f gbk -t utf-8)

          echo "åŸå§‹è¿”å›ï¼š$data"

          # å¦‚æœè¿”å›ä¸ºç©ºï¼Œæ¨é€ä¸€æ¡æµ‹è¯•æ¶ˆæ¯
          if [[ -z "$data" ]]; then
            echo "âŒ æœªè·å–åˆ°æ•°æ®ï¼Œå¼ºåˆ¶æ¨é€æµ‹è¯•æ¶ˆæ¯"
            title="âš ï¸ æµ‹è¯•æ¨é€ï¼ˆæœªè·å–åˆ°æ•°æ®ï¼‰"
            desp="å¯èƒ½è¢«æ‹¦æˆªæˆ–ç½‘ç»œé”™è¯¯"
          else
            # æå–ç¤ºä¾‹æ•°å€¼ï¼ˆæ³¨æ„ï¼šæ–°æµªæ¥å£ä¸æä¾›å®¶æ•°ï¼Œè¿™é‡Œåªæ˜¯æ¼”ç¤ºï¼‰
            sh_val=$(echo "$data" | grep -oE '[0-9]+\.[0-9]+' | head -n 1)
            sz_val=$(echo "$data" | grep -oE '[0-9]+\.[0-9]+' | head -n 2 | tail -n 1)

            title="ğŸ“ˆ Aè‚¡å¸‚åœºæƒ…ç»ªç›‘æ§"
            desp="ä¸Šè¯æŒ‡æ•°: ${sh_val}\næ·±è¯æŒ‡æ•°: ${sz_val}\n\nï¼ˆæœ¬æ¬¡ä¸ºæµ‹è¯•æ¨é€ï¼Œæ¥å£è¿è¡Œæ­£å¸¸ï¼‰"
          fi

          echo "å‡†å¤‡æ¨é€..."
          # âš ï¸ æŠŠ XXXXXX æ”¹æˆä½ è‡ªå·±çš„ Serveré…± Key
          curl -s "https://sc3.ft07.com/send/XXXXXX.send?title=${title}&desp=${desp}"
