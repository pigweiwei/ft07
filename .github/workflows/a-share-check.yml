name: æ£€æµ‹Aè‚¡ä¸‹è·Œå®¶æ•°å¹¶æ¨é€é€šçŸ¥

on:
  schedule:
    - cron: "*/15 * * * *"  # æ¯15åˆ†é’Ÿæ‰§è¡Œä¸€æ¬¡
  workflow_dispatch:        # å…è®¸æ‰‹åŠ¨è¿è¡Œ

jobs:
  check_a_shares:
    runs-on: ubuntu-latest

    steps:
      - name: è·å–ä¸‹è·Œå®¶æ•°
        id: fetch
        run: |
          # è·å–ä¸œæ–¹è´¢å¯ŒAè‚¡å¸‚åœºæ€»ä½“æ•°æ®ï¼ˆåŒ…å«ä¸Šæ¶¨ä¸‹è·Œå®¶æ•°ï¼‰
          data=$(curl -s "https://push2.eastmoney.com/api/qt/ulist.np/get?fltt=2&fields=f104&secids=1.000001")
          
          # ä»è¿”å›æ•°æ®ä¸­æå–ä¸‹è·Œå®¶æ•°ï¼ˆf104å­—æ®µæ˜¯ä¸‹è·Œå®¶æ•°ï¼‰
          down=$(echo "$data" | grep -o '"f104":[0-9]*' | head -n1 | cut -d: -f2)
          
          echo "down=$down" >> $GITHUB_OUTPUT
          echo "å½“å‰ä¸‹è·Œå®¶æ•°ï¼š$down"

      - name: åˆ¤æ–­å¹¶æ¨é€ Serveré…± é€šçŸ¥
        if: ${{ steps.fetch.outputs.down > 3500 }}
        run: |
          curl -X POST https://sctapi.ftqq.com/${{ secrets.SERVERCHAN_KEY }}.send \
            -d "title=Aè‚¡é¢„è­¦ï¼šä¸‹è·Œå®¶æ•°è¶…è¿‡3500å®¶ğŸš¨" \
            -d "desp=å½“å‰ä¸‹è·Œå®¶æ•°ï¼š${{ steps.fetch.outputs.down }}%0Aæ•°æ®æ¥æºï¼šä¸œæ–¹è´¢å¯Œ%0Aæ—¶é—´ï¼š$(date '+%Y-%m-%d %H:%M:%S')"
